title:: 【Reading Highlights】深度解析开源推荐算法框架 EasyRec 的核心概念和优势
source:: https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3
summary:: 
tags:: [[简悦]] [[datafun]]  [[阿里技术]]   [[reading_highlights]]
date:: 20220609  

- > ![](https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPg93GiczkaQW4ABsibZRSyxhRt5kuWAbXSTib5iaCAHhUG7K9q5gCXHvqtGVXS76oSqTywsXf3eKFCYLw/640?wx_fmt=png) [[系统架构]]   ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPg93GiczkaQW4ABsibZRSyxhRt5kuWAbXSTib5iaCAHhUG7K9q5gCXHvqtGVXS76oSqTywsXf3eKFCYLw/640?wx_fmt=png))
  - 📝 [[EasyRec]]

- > 为了提升 inference 性能，EasyRec 引入了 PAI Blade 的能力做 placement 优化，op fusion，子图去重等功能，通过上述优化 qps 提升 30% 以上，rt 下降 50%。未来还将引入 FP16 的功能，进一步提升 inference 性能，降低 memory 的消耗。  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E4%B8%BA%E4%BA%86%E6%8F%90%E5%8D%87%20inference%20%E6%80%A7%E8%83%BD%EF%BC%8CEasyRec%20%E5%BC%95%E5%85%A5%E4%BA%86%20PAI%20Blade%20%E7%9A%84%E8%83%BD%E5%8A%9B%E5%81%9A%20placement%20%E4%BC%98%E5%8C%96%EF%BC%8Cop%20fusion%EF%BC%8C%E5%AD%90%E5%9B%BE%E5%8E%BB%E9%87%8D%E7%AD%89%E5%8A%9F%E8%83%BD%EF%BC%8C%E9%80%9A%E8%BF%87%E4%B8%8A%E8%BF%B0%E4%BC%98%E5%8C%96%20qps%20%E6%8F%90%E5%8D%87%2030%25%20%E4%BB%A5%E4%B8%8A%EF%BC%8Crt%20%E4%B8%8B%E9%99%8D%2050%25%E3%80%82%E6%9C%AA%E6%9D%A5%E8%BF%98%E5%B0%86%E5%BC%95%E5%85%A5%20FP16%20%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%8F%90%E5%8D%87%20inference%20%E6%80%A7%E8%83%BD%EF%BC%8C%E9%99%8D%E4%BD%8E%20memory%20%E7%9A%84%E6%B6%88%E8%80%97%E3%80%82))

- > 为了支持超大规模的 Embedding，EasyRec 对大模型做了拆分和 op 替换，将 Embedding 存储到 Redis 等分布式缓存里面，突破了内存的限制。从 Redis 获取 embedding 会比内存慢，通过对高频 id 进行 cache 等来降低对 redis 的访问来提升 embedding lookup 的速度。  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E4%B8%BA%E4%BA%86%E6%94%AF%E6%8C%81%E8%B6%85%E5%A4%A7%E8%A7%84%E6%A8%A1%E7%9A%84%20Embedding%EF%BC%8CEasyRec%20%E5%AF%B9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%81%9A%E4%BA%86%E6%8B%86%E5%88%86%E5%92%8C%20op%20%E6%9B%BF%E6%8D%A2%EF%BC%8C%E5%B0%86%20Embedding%20%E5%AD%98%E5%82%A8%E5%88%B0%20Redis%20%E7%AD%89%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%E9%87%8C%E9%9D%A2%EF%BC%8C%E7%AA%81%E7%A0%B4%E4%BA%86%E5%86%85%E5%AD%98%E7%9A%84%E9%99%90%E5%88%B6%E3%80%82%E4%BB%8E%20Redis%20%E8%8E%B7%E5%8F%96%20embedding%20%E4%BC%9A%E6%AF%94%E5%86%85%E5%AD%98%E6%85%A2%EF%BC%8C%E9%80%9A%E8%BF%87%E5%AF%B9%E9%AB%98%E9%A2%91%20id%20%E8%BF%9B%E8%A1%8C%20cache%20%E7%AD%89%E6%9D%A5%E9%99%8D%E4%BD%8E%E5%AF%B9%20redis%20%E7%9A%84%E8%AE%BF%E9%97%AE%E6%9D%A5%E6%8F%90%E5%8D%87%20embedding%20lookup%20%E7%9A%84%E9%80%9F%E5%BA%A6%E3%80%82))

- > ![](https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPg93GiczkaQW4ABsibZRSyxhRntXhfry3YgA2u0ExQOreKAvpmm00Nrvj439r6ekoW1npUxmSIAQx7w/640?wx_fmt=png)  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPg93GiczkaQW4ABsibZRSyxhRntXhfry3YgA2u0ExQOreKAvpmm00Nrvj439r6ekoW1npUxmSIAQx7w/640?wx_fmt=png))

- > 为了能够在快速迭代中保持离线在线的一致性，通常采用的方法是线上线下采用同一套代码。 [[特征工程]]   ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E4%B8%BA%E4%BA%86%E8%83%BD%E5%A4%9F%E5%9C%A8%E5%BF%AB%E9%80%9F%E8%BF%AD%E4%BB%A3%E4%B8%AD%E4%BF%9D%E6%8C%81%E7%A6%BB%E7%BA%BF%E5%9C%A8%E7%BA%BF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%8C%E9%80%9A%E5%B8%B8%E9%87%87%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95%E6%98%AF%E7%BA%BF%E4%B8%8A%E7%BA%BF%E4%B8%8B%E9%87%87%E7%94%A8%E5%90%8C%E4%B8%80%E5%A5%97%E4%BB%A3%E7%A0%81%E3%80%82))

- > *   **离线训练数据的构造流程：**
    

首先，构造 user feature(包含实时和离线两部分), item feature 和 context_feature；然后，join 上训练样本 (包含 label)；最后，经过特征工程的 jar 包生成输入 EasyRec 的训练样本。  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E7%A6%BB%E7%BA%BF%E8%AE%AD%E7%BB%83%E6%95%B0%E6%8D%AE%E7%9A%84%E6%9E%84%E9%80%A0%E6%B5%81%E7%A8%8B%EF%BC%9A%E9%A6%96%E5%85%88%EF%BC%8C%E6%9E%84%E9%80%A0%20user%20feature(%E5%8C%85%E5%90%AB%E5%AE%9E%E6%97%B6%E5%92%8C%E7%A6%BB%E7%BA%BF%E4%B8%A4%E9%83%A8%E5%88%86),%20item%20feature%20%E5%92%8C%20context_feature%EF%BC%9B%E7%84%B6%E5%90%8E%EF%BC%8Cjoin%20%E4%B8%8A%E8%AE%AD%E7%BB%83%E6%A0%B7%E6%9C%AC%20(%E5%8C%85%E5%90%AB%20label)%EF%BC%9B%E6%9C%80%E5%90%8E%EF%BC%8C%E7%BB%8F%E8%BF%87%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B%E7%9A%84%20jar%20%E5%8C%85%E7%94%9F%E6%88%90%E8%BE%93%E5%85%A5%20EasyRec%20%E7%9A%84%E8%AE%AD%E7%BB%83%E6%A0%B7%E6%9C%AC%E3%80%82))

- > *   **上线的流程：**
    

将 user feature(离线部分) 和 item feature 导入 Redis、Hologres 等分布式存储，推荐引擎根据 user_id 和 item_id 去查询对应的特征，调用特征工程的库进行加工之后，送入 EasyRec 模型预测。  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E4%B8%8A%E7%BA%BF%E7%9A%84%E6%B5%81%E7%A8%8B%EF%BC%9A%E5%B0%86%20user%20feature(%E7%A6%BB%E7%BA%BF%E9%83%A8%E5%88%86)%20%E5%92%8C%20item%20feature%20%E5%AF%BC%E5%85%A5%20Redis%E3%80%81Hologres%20%E7%AD%89%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%EF%BC%8C%E6%8E%A8%E8%8D%90%E5%BC%95%E6%93%8E%E6%A0%B9%E6%8D%AE%20user_id%20%E5%92%8C%20item_id%20%E5%8E%BB%E6%9F%A5%E8%AF%A2%E5%AF%B9%E5%BA%94%E7%9A%84%E7%89%B9%E5%BE%81%EF%BC%8C%E8%B0%83%E7%94%A8%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B%E7%9A%84%E5%BA%93%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%B7%A5%E4%B9%8B%E5%90%8E%EF%BC%8C%E9%80%81%E5%85%A5%20EasyRec%20%E6%A8%A1%E5%9E%8B%E9%A2%84%E6%B5%8B%E3%80%82))

- > 在线部分的实时特征通常是使用 blink、alink 等支持流式计算的平台来生成的，而离线部分的实时特征构造有两种方式：离线模拟和在线落特征。  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E5%9C%A8%E7%BA%BF%E9%83%A8%E5%88%86%E7%9A%84%E5%AE%9E%E6%97%B6%E7%89%B9%E5%BE%81%E9%80%9A%E5%B8%B8%E6%98%AF%E4%BD%BF%E7%94%A8%20blink%E3%80%81alink%20%E7%AD%89%E6%94%AF%E6%8C%81%E6%B5%81%E5%BC%8F%E8%AE%A1%E7%AE%97%E7%9A%84%E5%B9%B3%E5%8F%B0%E6%9D%A5%E7%94%9F%E6%88%90%E7%9A%84%EF%BC%8C%E8%80%8C%E7%A6%BB%E7%BA%BF%E9%83%A8%E5%88%86%E7%9A%84%E5%AE%9E%E6%97%B6%E7%89%B9%E5%BE%81%E6%9E%84%E9%80%A0%E6%9C%89%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9A%E7%A6%BB%E7%BA%BF%E6%A8%A1%E6%8B%9F%E5%92%8C%E5%9C%A8%E7%BA%BF%E8%90%BD%E7%89%B9%E5%BE%81%E3%80%82))

- > 由于日志丢失等问题，离线模拟通常会和线上有少量的不一致；在线落特征如果要增加新的特征通常要等待比较长的时间才能攒够样本。我们的解决方案是在线将用户行为的序列落下来，然后离线通过相同的 jar 包来加工出各种统计特征，如 1h/2h/../24h 的点击次数。  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E7%94%B1%E4%BA%8E%E6%97%A5%E5%BF%97%E4%B8%A2%E5%A4%B1%E7%AD%89%E9%97%AE%E9%A2%98%EF%BC%8C%E7%A6%BB%E7%BA%BF%E6%A8%A1%E6%8B%9F%E9%80%9A%E5%B8%B8%E4%BC%9A%E5%92%8C%E7%BA%BF%E4%B8%8A%E6%9C%89%E5%B0%91%E9%87%8F%E7%9A%84%E4%B8%8D%E4%B8%80%E8%87%B4%EF%BC%9B%E5%9C%A8%E7%BA%BF%E8%90%BD%E7%89%B9%E5%BE%81%E5%A6%82%E6%9E%9C%E8%A6%81%E5%A2%9E%E5%8A%A0%E6%96%B0%E7%9A%84%E7%89%B9%E5%BE%81%E9%80%9A%E5%B8%B8%E8%A6%81%E7%AD%89%E5%BE%85%E6%AF%94%E8%BE%83%E9%95%BF%E7%9A%84%E6%97%B6%E9%97%B4%E6%89%8D%E8%83%BD%E6%94%92%E5%A4%9F%E6%A0%B7%E6%9C%AC%E3%80%82%E6%88%91%E4%BB%AC%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%98%AF%E5%9C%A8%E7%BA%BF%E5%B0%86%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E7%9A%84%E5%BA%8F%E5%88%97%E8%90%BD%E4%B8%8B%E6%9D%A5%EF%BC%8C%E7%84%B6%E5%90%8E%E7%A6%BB%E7%BA%BF%E9%80%9A%E8%BF%87%E7%9B%B8%E5%90%8C%E7%9A%84%20jar%20%E5%8C%85%E6%9D%A5%E5%8A%A0%E5%B7%A5%E5%87%BA%E5%90%84%E7%A7%8D%E7%BB%9F%E8%AE%A1%E7%89%B9%E5%BE%81%EF%BC%8C%E5%A6%82%201h/2h/../24h%20%E7%9A%84%E7%82%B9%E5%87%BB%E6%AC%A1%E6%95%B0%E3%80%82))

- > 在线特征工程对计算效率要求比较高，而计算量也比离线要大：

离线计算的样本通常是 1 个 user 配对 m 个曝光的 item(召回模型的话，会增加一些随机采样的负样本), 而线上计算的样本是 1 个 user 配对 n 个 item(n>>m)。在线计算如果采用 naive 的计算方式，将一次请求展开成 n 个样本分别进行计算，效率通常是跟不上的  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E5%9C%A8%E7%BA%BF%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B%E5%AF%B9%E8%AE%A1%E7%AE%97%E6%95%88%E7%8E%87%E8%A6%81%E6%B1%82%E6%AF%94%E8%BE%83%E9%AB%98%EF%BC%8C%E8%80%8C%E8%AE%A1%E7%AE%97%E9%87%8F%E4%B9%9F%E6%AF%94%E7%A6%BB%E7%BA%BF%E8%A6%81%E5%A4%A7%EF%BC%9A%E7%A6%BB%E7%BA%BF%E8%AE%A1%E7%AE%97%E7%9A%84%E6%A0%B7%E6%9C%AC%E9%80%9A%E5%B8%B8%E6%98%AF%201%20%E4%B8%AA%20user%20%E9%85%8D%E5%AF%B9%20m%20%E4%B8%AA%E6%9B%9D%E5%85%89%E7%9A%84%20item(%E5%8F%AC%E5%9B%9E%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%AF%9D%EF%BC%8C%E4%BC%9A%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%BA%9B%E9%9A%8F%E6%9C%BA%E9%87%87%E6%A0%B7%E7%9A%84%E8%B4%9F%E6%A0%B7%E6%9C%AC),%20%E8%80%8C%E7%BA%BF%E4%B8%8A%E8%AE%A1%E7%AE%97%E7%9A%84%E6%A0%B7%E6%9C%AC%E6%98%AF%201%20%E4%B8%AA%20user%20%E9%85%8D%E5%AF%B9%20n%20%E4%B8%AA%20item(n%3E%3Em)%E3%80%82%E5%9C%A8%E7%BA%BF%E8%AE%A1%E7%AE%97%E5%A6%82%E6%9E%9C%E9%87%87%E7%94%A8%20naive%20%E7%9A%84%E8%AE%A1%E7%AE%97%E6%96%B9%E5%BC%8F%EF%BC%8C%E5%B0%86%E4%B8%80%E6%AC%A1%E8%AF%B7%E6%B1%82%E5%B1%95%E5%BC%80%E6%88%90%20n%20%E4%B8%AA%E6%A0%B7%E6%9C%AC%E5%88%86%E5%88%AB%E8%BF%9B%E8%A1%8C%E8%AE%A1%E7%AE%97%EF%BC%8C%E6%95%88%E7%8E%87%E9%80%9A%E5%B8%B8%E6%98%AF%E8%B7%9F%E4%B8%8D%E4%B8%8A%E7%9A%84))

- > user feature 的部分做了比较多的重复计算，对 user feature 做计算效率的优化，能够显著提升线上的 qps。我们结合淘系内部使用的 Feature Generation 模块做了深度优化，包括内存分配、字符串解析、重复计算消除、多线程并行计算等，在保证一致性的前提下，显著提高了计算的效率。  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=user%20feature%20%E7%9A%84%E9%83%A8%E5%88%86%E5%81%9A%E4%BA%86%E6%AF%94%E8%BE%83%E5%A4%9A%E7%9A%84%E9%87%8D%E5%A4%8D%E8%AE%A1%E7%AE%97%EF%BC%8C%E5%AF%B9%20user%20feature%20%E5%81%9A%E8%AE%A1%E7%AE%97%E6%95%88%E7%8E%87%E7%9A%84%E4%BC%98%E5%8C%96%EF%BC%8C%E8%83%BD%E5%A4%9F%E6%98%BE%E8%91%97%E6%8F%90%E5%8D%87%E7%BA%BF%E4%B8%8A%E7%9A%84%20qps%E3%80%82%E6%88%91%E4%BB%AC%E7%BB%93%E5%90%88%E6%B7%98%E7%B3%BB%E5%86%85%E9%83%A8%E4%BD%BF%E7%94%A8%E7%9A%84%20Feature%20Generation%20%E6%A8%A1%E5%9D%97%E5%81%9A%E4%BA%86%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%8C%96%EF%BC%8C%E5%8C%85%E6%8B%AC%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E3%80%81%E9%87%8D%E5%A4%8D%E8%AE%A1%E7%AE%97%E6%B6%88%E9%99%A4%E3%80%81%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E7%AD%89%EF%BC%8C%E5%9C%A8%E4%BF%9D%E8%AF%81%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E5%89%8D%E6%8F%90%E4%B8%8B%EF%BC%8C%E6%98%BE%E8%91%97%E6%8F%90%E9%AB%98%E4%BA%86%E8%AE%A1%E7%AE%97%E7%9A%84%E6%95%88%E7%8E%87%E3%80%82))

- > ![](https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPg93GiczkaQW4ABsibZRSyxhRSy6glAbsicY5y9NRp0dqKoLNMAxsamXZq5LP8UfN7e09oQrBDJ2iceaw/640?wx_fmt=png)  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPg93GiczkaQW4ABsibZRSyxhRSy6glAbsicY5y9NRp0dqKoLNMAxsamXZq5LP8UfN7e09oQrBDJ2iceaw/640?wx_fmt=png))

- > 增量训练通常能够带来效果的显著提升，原因在于增量训练见过了更多的样本，对 embeding 部分训练地更加充分。

EasyRec 支持从上一天的 checkpoint restore，然后在新的一天的数据上继续训练。  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E5%A2%9E%E9%87%8F%E8%AE%AD%E7%BB%83%E9%80%9A%E5%B8%B8%E8%83%BD%E5%A4%9F%E5%B8%A6%E6%9D%A5%E6%95%88%E6%9E%9C%E7%9A%84%E6%98%BE%E8%91%97%E6%8F%90%E5%8D%87%EF%BC%8C%E5%8E%9F%E5%9B%A0%E5%9C%A8%E4%BA%8E%E5%A2%9E%E9%87%8F%E8%AE%AD%E7%BB%83%E8%A7%81%E8%BF%87%E4%BA%86%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%A0%B7%E6%9C%AC%EF%BC%8C%E5%AF%B9%20embeding%20%E9%83%A8%E5%88%86%E8%AE%AD%E7%BB%83%E5%9C%B0%E6%9B%B4%E5%8A%A0%E5%85%85%E5%88%86%E3%80%82EasyRec%20%E6%94%AF%E6%8C%81%E4%BB%8E%E4%B8%8A%E4%B8%80%E5%A4%A9%E7%9A%84%20checkpoint%20restore%EF%BC%8C%E7%84%B6%E5%90%8E%E5%9C%A8%E6%96%B0%E7%9A%84%E4%B8%80%E5%A4%A9%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%8A%E7%BB%A7%E7%BB%AD%E8%AE%AD%E7%BB%83%E3%80%82))

- > 为了快速适应新闻、节假日、大促等场景的样本分布发生快速变化的场景，我们提供了对实时训练的支持。EasyRec 通过 Blink 来构造实时样本和特征，并调用 Feature Generation 对特征进行加工，然后通过 Kafka、DataHub 读取实时的样本流进行训练。  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E4%B8%BA%E4%BA%86%E5%BF%AB%E9%80%9F%E9%80%82%E5%BA%94%E6%96%B0%E9%97%BB%E3%80%81%E8%8A%82%E5%81%87%E6%97%A5%E3%80%81%E5%A4%A7%E4%BF%83%E7%AD%89%E5%9C%BA%E6%99%AF%E7%9A%84%E6%A0%B7%E6%9C%AC%E5%88%86%E5%B8%83%E5%8F%91%E7%94%9F%E5%BF%AB%E9%80%9F%E5%8F%98%E5%8C%96%E7%9A%84%E5%9C%BA%E6%99%AF%EF%BC%8C%E6%88%91%E4%BB%AC%E6%8F%90%E4%BE%9B%E4%BA%86%E5%AF%B9%E5%AE%9E%E6%97%B6%E8%AE%AD%E7%BB%83%E7%9A%84%E6%94%AF%E6%8C%81%E3%80%82EasyRec%20%E9%80%9A%E8%BF%87%20Blink%20%E6%9D%A5%E6%9E%84%E9%80%A0%E5%AE%9E%E6%97%B6%E6%A0%B7%E6%9C%AC%E5%92%8C%E7%89%B9%E5%BE%81%EF%BC%8C%E5%B9%B6%E8%B0%83%E7%94%A8%20Feature%20Generation%20%E5%AF%B9%E7%89%B9%E5%BE%81%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%B7%A5%EF%BC%8C%E7%84%B6%E5%90%8E%E9%80%9A%E8%BF%87%20Kafka%E3%80%81DataHub%20%E8%AF%BB%E5%8F%96%E5%AE%9E%E6%97%B6%E7%9A%84%E6%A0%B7%E6%9C%AC%E6%B5%81%E8%BF%9B%E8%A1%8C%E8%AE%AD%E7%BB%83%E3%80%82))

- > 实时训练的稳定性比较重要，我们在训练过程中对正负样本比、特征的分布、模型的 auc 等做实时的监控，当样本和特征的分布变化超过阈值时，报警并停止更新模型。  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E5%AE%9E%E6%97%B6%E8%AE%AD%E7%BB%83%E7%9A%84%E7%A8%B3%E5%AE%9A%E6%80%A7%E6%AF%94%E8%BE%83%E9%87%8D%E8%A6%81%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E8%AE%AD%E7%BB%83%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%AF%B9%E6%AD%A3%E8%B4%9F%E6%A0%B7%E6%9C%AC%E6%AF%94%E3%80%81%E7%89%B9%E5%BE%81%E7%9A%84%E5%88%86%E5%B8%83%E3%80%81%E6%A8%A1%E5%9E%8B%E7%9A%84%20auc%20%E7%AD%89%E5%81%9A%E5%AE%9E%E6%97%B6%E7%9A%84%E7%9B%91%E6%8E%A7%EF%BC%8C%E5%BD%93%E6%A0%B7%E6%9C%AC%E5%92%8C%E7%89%B9%E5%BE%81%E7%9A%84%E5%88%86%E5%B8%83%E5%8F%98%E5%8C%96%E8%B6%85%E8%BF%87%E9%98%88%E5%80%BC%E6%97%B6%EF%BC%8C%E6%8A%A5%E8%AD%A6%E5%B9%B6%E5%81%9C%E6%AD%A2%E6%9B%B4%E6%96%B0%E6%A8%A1%E5%9E%8B%E3%80%82))

- > 保存 checkpoint 时，EasyRec 会同步记录当前训练的 offsets(多个 worker 一起训练时，会有多个 offset)，当系统发生故障重启时，会从保存的 offsets 恢复训练。  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=%E4%BF%9D%E5%AD%98%20checkpoint%20%E6%97%B6%EF%BC%8CEasyRec%20%E4%BC%9A%E5%90%8C%E6%AD%A5%E8%AE%B0%E5%BD%95%E5%BD%93%E5%89%8D%E8%AE%AD%E7%BB%83%E7%9A%84%20offsets(%E5%A4%9A%E4%B8%AA%20worker%20%E4%B8%80%E8%B5%B7%E8%AE%AD%E7%BB%83%E6%97%B6%EF%BC%8C%E4%BC%9A%E6%9C%89%E5%A4%9A%E4%B8%AA%20offset)%EF%BC%8C%E5%BD%93%E7%B3%BB%E7%BB%9F%E5%8F%91%E7%94%9F%E6%95%85%E9%9A%9C%E9%87%8D%E5%90%AF%E6%97%B6%EF%BC%8C%E4%BC%9A%E4%BB%8E%E4%BF%9D%E5%AD%98%E7%9A%84%20offsets%20%E6%81%A2%E5%A4%8D%E8%AE%AD%E7%BB%83%E3%80%82))

- > ![](https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPg93GiczkaQW4ABsibZRSyxhRB27mV5YHyctfSkDlLSokzickJq2Q0nz7uyF1qLiaiaOv5QsAD1mA5wDNg/640?wx_fmt=png)  ([🌐 摘要链接](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247569807&idx=2&sn=8d133978b9c78529d6c83c756c4a242d&sessionid=1652108830&subscene=91&clicktime=1652109030&enterid=1652109030&ascene=3&version=28001557&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&session_us=gh_3420d4a1369b&pass_ticket=qcjb4pLFGt71RXP5hdwwXN7pGjDURgSeM%2BC8ZiitvbzpbqPOszJcQMY5u0hormQk&wx_header=3#js_content:~:text=https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPg93GiczkaQW4ABsibZRSyxhRB27mV5YHyctfSkDlLSokzickJq2Q0nz7uyF1qLiaiaOv5QsAD1mA5wDNg/640?wx_fmt=png))

