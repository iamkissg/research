title:: 【Reading Highlights】从阿里的 User Interest Center 看模型线上实时 serving 方法
source:: https://zhuanlan.zhihu.com/p/111929212
summary:: 
tags:: [[简悦]] [[王喆]]  [[阿里技术]]   [[reading_highlights]]
date:: 20220531  

- > ![](https://pic2.zhimg.com/v2-8409fd79a63ce2b0231b670f8c2bfb2d_r.jpg) [[模型结构]]  [[阿里技术]]   ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/111929212#js_content:~:text=https://pic2.zhimg.com/v2-8409fd79a63ce2b0231b670f8c2bfb2d_r.jpg))
  - 📝 阿里巴巴 User Interest Center 示意图

- > B 架构将 A 架构的 “用户行为特征(User Behavior Features) 在线数据库”替换成了“**用户兴趣表达 (User Interest Representation) 在线数据库**”。  ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/111929212#js_content:~:text=B%20%E6%9E%B6%E6%9E%84%E5%B0%86%20A%20%E6%9E%B6%E6%9E%84%E7%9A%84%20%E2%80%9C%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E7%89%B9%E5%BE%81(User%20Behavior%20Features)%20%E5%9C%A8%E7%BA%BF%E6%95%B0%E6%8D%AE%E5%BA%93%E2%80%9D%E6%9B%BF%E6%8D%A2%E6%88%90%E4%BA%86%E2%80%9C%E7%94%A8%E6%88%B7%E5%85%B4%E8%B6%A3%E8%A1%A8%E8%BE%BE%20(User%20Interest%20Representation)%20%E5%9C%A8%E7%BA%BF%E6%95%B0%E6%8D%AE%E5%BA%93%E2%80%9D%E3%80%82))

- > 虽然 “用户兴趣表达模块” 这个名字很 fancy，但本质上应该是以类似 redis 的内存数据库为主实现的。  ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/111929212#js_content:~:text=%E8%99%BD%E7%84%B6%20%E2%80%9C%E7%94%A8%E6%88%B7%E5%85%B4%E8%B6%A3%E8%A1%A8%E8%BE%BE%E6%A8%A1%E5%9D%97%E2%80%9D%20%E8%BF%99%E4%B8%AA%E5%90%8D%E5%AD%97%E5%BE%88%20fancy%EF%BC%8C%E4%BD%86%E6%9C%AC%E8%B4%A8%E4%B8%8A%E5%BA%94%E8%AF%A5%E6%98%AF%E4%BB%A5%E7%B1%BB%E4%BC%BC%20redis%20%E7%9A%84%E5%86%85%E5%AD%98%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%BA%E4%B8%BB%E5%AE%9E%E7%8E%B0%E7%9A%84%E3%80%82))

- > B 架构增加了一个服务模块——**用户兴趣中心 (User Interest Center，UIC)**。 UIC 用于根据用户行为序列生成用户兴趣向量，对 DIEN 和 MIMN 来说，UIC 运行着生成用户兴趣向量的部分模型。  ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/111929212#js_content:~:text=%E7%94%A8%E6%88%B7%E5%85%B4%E8%B6%A3%E4%B8%AD%E5%BF%83%20(User%20Interest%20Center%EF%BC%8CUIC)B%20%E6%9E%B6%E6%9E%84%E5%A2%9E%E5%8A%A0%E4%BA%86%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97%E2%80%94%E2%80%94%E3%80%82%20UIC%20%E7%94%A8%E4%BA%8E%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97%E7%94%9F%E6%88%90%E7%94%A8%E6%88%B7%E5%85%B4%E8%B6%A3%E5%90%91%E9%87%8F%EF%BC%8C%E5%AF%B9%20DIEN%20%E5%92%8C%20MIMN%20%E6%9D%A5%E8%AF%B4%EF%BC%8CUIC%20%E8%BF%90%E8%A1%8C%E7%9D%80%E7%94%9F%E6%88%90%E7%94%A8%E6%88%B7%E5%85%B4%E8%B6%A3%E5%90%91%E9%87%8F%E7%9A%84%E9%83%A8%E5%88%86%E6%A8%A1%E5%9E%8B%E3%80%82))

- > 对 B 架构来说，**新的用户行为事件会触发 UIC 的更新逻辑**，UIC 会利用该事件更新对应用户的兴趣 Embedding 向量。  ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/111929212#js_content:~:text=%E6%96%B0%E7%9A%84%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E4%BA%8B%E4%BB%B6%E4%BC%9A%E8%A7%A6%E5%8F%91%20UIC%20%E7%9A%84%E6%9B%B4%E6%96%B0%E9%80%BB%E8%BE%91%E5%AF%B9%20B%20%E6%9E%B6%E6%9E%84%E6%9D%A5%E8%AF%B4%EF%BC%8C%EF%BC%8CUIC%20%E4%BC%9A%E5%88%A9%E7%94%A8%E8%AF%A5%E4%BA%8B%E4%BB%B6%E6%9B%B4%E6%96%B0%E5%AF%B9%E5%BA%94%E7%94%A8%E6%88%B7%E7%9A%84%E5%85%B4%E8%B6%A3%20Embedding%20%E5%90%91%E9%87%8F%E3%80%82))

- > 用户的 embedding 会在行为发生改变时通过模型离线推断完成更新。某种意义上说，这也可以算是一种模型 online learning 的方法之一了。  ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/111929212#js_content:~:text=%E7%94%A8%E6%88%B7%E7%9A%84%20embedding%20%E4%BC%9A%E5%9C%A8%E8%A1%8C%E4%B8%BA%E5%8F%91%E7%94%9F%E6%94%B9%E5%8F%98%E6%97%B6%E9%80%9A%E8%BF%87%E6%A8%A1%E5%9E%8B%E7%A6%BB%E7%BA%BF%E6%8E%A8%E6%96%AD%E5%AE%8C%E6%88%90%E6%9B%B4%E6%96%B0%E3%80%82%E6%9F%90%E7%A7%8D%E6%84%8F%E4%B9%89%E4%B8%8A%E8%AF%B4%EF%BC%8C%E8%BF%99%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%AE%97%E6%98%AF%E4%B8%80%E7%A7%8D%E6%A8%A1%E5%9E%8B%20online%20learning%20%E7%9A%84%E6%96%B9%E6%B3%95%E4%B9%8B%E4%B8%80%E4%BA%86%E3%80%82))

- > Model Serving 的过程：

1.  流量请求 (traffic request) 到来，其中携带了用户 ID(User ID)和待排序的候选商品 ID(Ad ID)。
2.  实时预估服务器根据用户 ID 和候选商品 ID 获取用户和商品特征 (Ad Features)，用户特征具体包括用户的人口属性特征(User Demography Features) 和用户行为特征(a 架构) 或用户兴趣表达向量(b 架构)。
3.  实时预估服务器利用用户和商品特征进行预估和排序，返回最终排序结果给请求方。b 架构对最耗时的序列模型部分进行了拆解，因此大幅降低了模型服务的总延迟。
4.  返回模型预估结果。  ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/111929212#js_content:~:text=Model%20Serving%20%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%9A%E6%B5%81%E9%87%8F%E8%AF%B7%E6%B1%82%20(traffic%20request)%20%E5%88%B0%E6%9D%A5%EF%BC%8C%E5%85%B6%E4%B8%AD%E6%90%BA%E5%B8%A6%E4%BA%86%E7%94%A8%E6%88%B7%20ID(User%20ID)%E5%92%8C%E5%BE%85%E6%8E%92%E5%BA%8F%E7%9A%84%E5%80%99%E9%80%89%E5%95%86%E5%93%81%20ID(Ad%20ID)%E3%80%82%E5%AE%9E%E6%97%B6%E9%A2%84%E4%BC%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%20ID%20%E5%92%8C%E5%80%99%E9%80%89%E5%95%86%E5%93%81%20ID%20%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%92%8C%E5%95%86%E5%93%81%E7%89%B9%E5%BE%81%20(Ad%20Features)%EF%BC%8C%E7%94%A8%E6%88%B7%E7%89%B9%E5%BE%81%E5%85%B7%E4%BD%93%E5%8C%85%E6%8B%AC%E7%94%A8%E6%88%B7%E7%9A%84%E4%BA%BA%E5%8F%A3%E5%B1%9E%E6%80%A7%E7%89%B9%E5%BE%81(User%20Demography%20Features)%20%E5%92%8C%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E7%89%B9%E5%BE%81(a%20%E6%9E%B6%E6%9E%84)%20%E6%88%96%E7%94%A8%E6%88%B7%E5%85%B4%E8%B6%A3%E8%A1%A8%E8%BE%BE%E5%90%91%E9%87%8F(b%20%E6%9E%B6%E6%9E%84)%E3%80%82%E5%AE%9E%E6%97%B6%E9%A2%84%E4%BC%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E5%92%8C%E5%95%86%E5%93%81%E7%89%B9%E5%BE%81%E8%BF%9B%E8%A1%8C%E9%A2%84%E4%BC%B0%E5%92%8C%E6%8E%92%E5%BA%8F%EF%BC%8C%E8%BF%94%E5%9B%9E%E6%9C%80%E7%BB%88%E6%8E%92%E5%BA%8F%E7%BB%93%E6%9E%9C%E7%BB%99%E8%AF%B7%E6%B1%82%E6%96%B9%E3%80%82b%20%E6%9E%B6%E6%9E%84%E5%AF%B9%E6%9C%80%E8%80%97%E6%97%B6%E7%9A%84%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B%E9%83%A8%E5%88%86%E8%BF%9B%E8%A1%8C%E4%BA%86%E6%8B%86%E8%A7%A3%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%A4%A7%E5%B9%85%E9%99%8D%E4%BD%8E%E4%BA%86%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%80%BB%E5%BB%B6%E8%BF%9F%E3%80%82%E8%BF%94%E5%9B%9E%E6%A8%A1%E5%9E%8B%E9%A2%84%E4%BC%B0%E7%BB%93%E6%9E%9C%E3%80%82))

- > 阿里的 UIC 架构还是遵循了 “Embedding + 轻量级线上模型” 的部署方案，只不过利用 UIC 对 Embedding 部分的生成、存储、更新进行了近乎完美的管理。可以说是“**Embedding + 轻量级线上模型**” 这种 Model Serving 方法的 best practice。  ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/111929212#js_content:~:text=%E9%98%BF%E9%87%8C%E7%9A%84%20UIC%20%E6%9E%B6%E6%9E%84%E8%BF%98%E6%98%AF%E9%81%B5%E5%BE%AA%E4%BA%86%20%E2%80%9CEmbedding%20+%20%E8%BD%BB%E9%87%8F%E7%BA%A7%E7%BA%BF%E4%B8%8A%E6%A8%A1%E5%9E%8B%E2%80%9D%20%E7%9A%84%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88%EF%BC%8C%E5%8F%AA%E4%B8%8D%E8%BF%87%E5%88%A9%E7%94%A8%20UIC%20%E5%AF%B9%20Embedding%20%E9%83%A8%E5%88%86%E7%9A%84%E7%94%9F%E6%88%90%E3%80%81%E5%AD%98%E5%82%A8%E3%80%81%E6%9B%B4%E6%96%B0%E8%BF%9B%E8%A1%8C%E4%BA%86%E8%BF%91%E4%B9%8E%E5%AE%8C%E7%BE%8E%E7%9A%84%E7%AE%A1%E7%90%86%E3%80%82%E5%8F%AF%E4%BB%A5%E8%AF%B4%E6%98%AF%E2%80%9CEmbedding%20+%20%E8%BD%BB%E9%87%8F%E7%BA%A7%E7%BA%BF%E4%B8%8A%E6%A8%A1%E5%9E%8B%E2%80%9D%20%E8%BF%99%E7%A7%8D%20Model%20Serving%20%E6%96%B9%E6%B3%95%E7%9A%84%20best%20practice%E3%80%82))

