title:: 【Reading Highlights】推荐系统中的注意力机制——阿里深度兴趣网络（DIN）
source:: https://zhuanlan.zhihu.com/p/51623339
summary:: 
tags:: [[简悦]] [[序列化推荐]]  [[推荐系统]]  [[精排]]  [[阿里技术]]  [[王喆]]   [[reading_highlights]]
date:: 20220530  

- > 如果按照之前的做法，我们会一碗水端平的考虑所有行为记录的影响，对应到模型中就是我们会用一个 average pooling 层把用户交互过的所有商品的 embedding vector 平均一下形成这个用户的 user vector，机灵一点的工程师最多加一个 time decay，让最近的行为产生的影响大一些，那就是在做 average pooling 的时候按时间调整一下权重。  ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/51623339#js_content:~:text=%E5%A6%82%E6%9E%9C%E6%8C%89%E7%85%A7%E4%B9%8B%E5%89%8D%E7%9A%84%E5%81%9A%E6%B3%95%EF%BC%8C%E6%88%91%E4%BB%AC%E4%BC%9A%E4%B8%80%E7%A2%97%E6%B0%B4%E7%AB%AF%E5%B9%B3%E7%9A%84%E8%80%83%E8%99%91%E6%89%80%E6%9C%89%E8%A1%8C%E4%B8%BA%E8%AE%B0%E5%BD%95%E7%9A%84%E5%BD%B1%E5%93%8D%EF%BC%8C%E5%AF%B9%E5%BA%94%E5%88%B0%E6%A8%A1%E5%9E%8B%E4%B8%AD%E5%B0%B1%E6%98%AF%E6%88%91%E4%BB%AC%E4%BC%9A%E7%94%A8%E4%B8%80%E4%B8%AA%20average%20pooling%20%E5%B1%82%E6%8A%8A%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E8%BF%87%E7%9A%84%E6%89%80%E6%9C%89%E5%95%86%E5%93%81%E7%9A%84%20embedding%20vector%20%E5%B9%B3%E5%9D%87%E4%B8%80%E4%B8%8B%E5%BD%A2%E6%88%90%E8%BF%99%E4%B8%AA%E7%94%A8%E6%88%B7%E7%9A%84%20user%20vector%EF%BC%8C%E6%9C%BA%E7%81%B5%E4%B8%80%E7%82%B9%E7%9A%84%E5%B7%A5%E7%A8%8B%E5%B8%88%E6%9C%80%E5%A4%9A%E5%8A%A0%E4%B8%80%E4%B8%AA%20time%20decay%EF%BC%8C%E8%AE%A9%E6%9C%80%E8%BF%91%E7%9A%84%E8%A1%8C%E4%B8%BA%E4%BA%A7%E7%94%9F%E7%9A%84%E5%BD%B1%E5%93%8D%E5%A4%A7%E4%B8%80%E4%BA%9B%EF%BC%8C%E9%82%A3%E5%B0%B1%E6%98%AF%E5%9C%A8%E5%81%9A%20average%20pooling%20%E7%9A%84%E6%97%B6%E5%80%99%E6%8C%89%E6%97%B6%E9%97%B4%E8%B0%83%E6%95%B4%E4%B8%80%E4%B8%8B%E6%9D%83%E9%87%8D%E3%80%82))
  - 📝 [[DIN]]之前对用户行为序列的使用

- > ![](https://pic3.zhimg.com/v2-ba0d0fafc33999e9af1877cf6087523e_r.jpg) [[模型结构]]   ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/51623339#js_content:~:text=https://pic3.zhimg.com/v2-ba0d0fafc33999e9af1877cf6087523e_r.jpg))
  - 📝 [[DIN]] 的模型结构图

- > 相比原来这个标准的深度推荐网络（Base model），DIN 在生成用户 embedding vector 的时候加入了一个 activation unit 层  ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/51623339#js_content:~:text=%E7%9B%B8%E6%AF%94%E5%8E%9F%E6%9D%A5%E8%BF%99%E4%B8%AA%E6%A0%87%E5%87%86%E7%9A%84%E6%B7%B1%E5%BA%A6%E6%8E%A8%E8%8D%90%E7%BD%91%E7%BB%9C%EF%BC%88Base%20model%EF%BC%89%EF%BC%8CDIN%20%E5%9C%A8%E7%94%9F%E6%88%90%E7%94%A8%E6%88%B7%20embedding%20vector%20%E7%9A%84%E6%97%B6%E5%80%99%E5%8A%A0%E5%85%A5%E4%BA%86%E4%B8%80%E4%B8%AA%20activation%20unit%20%E5%B1%82))

- > 传统的 Attention 机制中，给定两个 item embedding，比如 u 和 v，通常是直接做点积 uv 或者 uWv，其中 W 是一个 | u|x|v | 的权重矩阵，但这篇 paper 中阿里显然做了更进一步的改进，着重看上图右上角的 activation unit，**首先是把 u 和 v 以及 u v 的 element wise 差值向量合并起来作为输入，然后喂给全连接层，最后得出权重**，这样的方法显然损失的信息更少。  ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/51623339#js_content:~:text=%E4%BC%A0%E7%BB%9F%E7%9A%84%20Attention%20%E6%9C%BA%E5%88%B6%E4%B8%AD%EF%BC%8C%E7%BB%99%E5%AE%9A%E4%B8%A4%E4%B8%AA%20item%20embedding%EF%BC%8C%E6%AF%94%E5%A6%82%20u%20%E5%92%8C%20v%EF%BC%8C%E9%80%9A%E5%B8%B8%E6%98%AF%E7%9B%B4%E6%8E%A5%E5%81%9A%E7%82%B9%E7%A7%AF%20uv%20%E6%88%96%E8%80%85%20uWv%EF%BC%8C%E5%85%B6%E4%B8%AD%20W%20%E6%98%AF%E4%B8%80%E4%B8%AA%20%7C%20u%7Cx%7Cv%20%7C%20%E7%9A%84%E6%9D%83%E9%87%8D%E7%9F%A9%E9%98%B5%EF%BC%8C%E4%BD%86%E8%BF%99%E7%AF%87%20paper%20%E4%B8%AD%E9%98%BF%E9%87%8C%E6%98%BE%E7%84%B6%E5%81%9A%E4%BA%86%E6%9B%B4%E8%BF%9B%E4%B8%80%E6%AD%A5%E7%9A%84%E6%94%B9%E8%BF%9B%EF%BC%8C%E7%9D%80%E9%87%8D%E7%9C%8B%E4%B8%8A%E5%9B%BE%E5%8F%B3%E4%B8%8A%E8%A7%92%E7%9A%84%20activation%20unit%EF%BC%8C%E9%A6%96%E5%85%88%E6%98%AF%E6%8A%8A%20u%20%E5%92%8C%20v%20%E4%BB%A5%E5%8F%8A%20u%20v%20%E7%9A%84%20element%20wise%20%E5%B7%AE%E5%80%BC%E5%90%91%E9%87%8F%E5%90%88%E5%B9%B6%E8%B5%B7%E6%9D%A5%E4%BD%9C%E4%B8%BA%E8%BE%93%E5%85%A5%EF%BC%8C%E7%84%B6%E5%90%8E%E5%96%82%E7%BB%99%E5%85%A8%E8%BF%9E%E6%8E%A5%E5%B1%82%EF%BC%8C%E6%9C%80%E5%90%8E%E5%BE%97%E5%87%BA%E6%9D%83%E9%87%8D%EF%BC%8C%E8%BF%99%E6%A0%B7%E7%9A%84%E6%96%B9%E6%B3%95%E6%98%BE%E7%84%B6%E6%8D%9F%E5%A4%B1%E7%9A%84%E4%BF%A1%E6%81%AF%E6%9B%B4%E5%B0%91%E3%80%82))
  - 📝 [[DIN]]使用的[[注意力]]有别于一般形式，将 u、v及它们的差值拼接后经过全连接层，得到权重。

- > 留意一下这个架构图中的红线，你会发现每个 ad 会有 good_id, shop_id 两层属性，shop_id 只跟用户历史中的 shop_id 序列发生作用，good_id 只跟用户的 good_id 序列发生作用  ([🌐 摘要链接](https://zhuanlan.zhihu.com/p/51623339#js_content:~:text=%E7%95%99%E6%84%8F%E4%B8%80%E4%B8%8B%E8%BF%99%E4%B8%AA%E6%9E%B6%E6%9E%84%E5%9B%BE%E4%B8%AD%E7%9A%84%E7%BA%A2%E7%BA%BF%EF%BC%8C%E4%BD%A0%E4%BC%9A%E5%8F%91%E7%8E%B0%E6%AF%8F%E4%B8%AA%20ad%20%E4%BC%9A%E6%9C%89%20good_id,%20shop_id%20%E4%B8%A4%E5%B1%82%E5%B1%9E%E6%80%A7%EF%BC%8Cshop_id%20%E5%8F%AA%E8%B7%9F%E7%94%A8%E6%88%B7%E5%8E%86%E5%8F%B2%E4%B8%AD%E7%9A%84%20shop_id%20%E5%BA%8F%E5%88%97%E5%8F%91%E7%94%9F%E4%BD%9C%E7%94%A8%EF%BC%8Cgood_id%20%E5%8F%AA%E8%B7%9F%E7%94%A8%E6%88%B7%E7%9A%84%20good_id%20%E5%BA%8F%E5%88%97%E5%8F%91%E7%94%9F%E4%BD%9C%E7%94%A8))
  - 📝 [[DIN]]区分了商品ID和店铺ID，两个分组分开计算。

